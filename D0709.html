<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>專業天氣與空氣品質查詢</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Microsoft JhengHei", sans-serif;
      padding: 20px;
    }
    .weather-card {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      max-width: 700px;
      width: 100%;
    }
    .aqi-badge {
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      display: inline-block;
      color: #fff;
    }
    .weather-icon {
      width: 100%;
      max-width: 150px;
    }
  </style>
</head>
<body>
  <div class="weather-card text-center">
    <h1 class="mb-4"><i class="bi bi-cloud-sun-fill me-2"></i>天氣與空氣品質查詢</h1>
    <div class="mb-3">
      <input type="text" id="cityInput" class="form-control form-control-lg text-center" placeholder="請輸入城市名稱">
    </div>
    <button class="btn btn-primary btn-lg" onclick="getWeatherAndAir()"><i class="bi bi-search"></i> 查詢</button>
    <div id="result" class="mt-4"></div>
  </div>

  <script>
    function getWeatherAndAir() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) {
        alert("請輸入城市名稱！");
        return;
      }

      const apiKey = "19af989e111a07a6ed10f4011f9e5d67"; // ← 替換成你的 API Key
      const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=zh_tw`;

      document.getElementById("result").innerHTML = `<div class="text-primary">資料查詢中，請稍候...</div>`;

      fetch(weatherUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error("查無此城市，請確認輸入是否正確。");
          }
          return response.json();
        })
        .then(data => {
          const name = data.name;
          const temp = data.main.temp;
          const desc = data.weather[0].description;
          const humidity = data.main.humidity;
          const wind = data.wind.speed;
          const icon = data.weather[0].icon;
          const iconUrl = `https://openweathermap.org/img/wn/${icon}@4x.png`;
          const lat = data.coord.lat;
          const lon = data.coord.lon;
          const dt = new Date(data.dt * 1000).toLocaleString("zh-TW");

          const airUrl = `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`;

          fetch(airUrl)
            .then(response => response.json())
            .then(airData => {
              const aqi = airData.list[0].main.aqi;
              const pm25 = airData.list[0].components.pm2_5;
              const pm10 = airData.list[0].components.pm10;
              const co = airData.list[0].components.co;
              const no2 = airData.list[0].components.no2;
              const o3 = airData.list[0].components.o3;

              let aqiText = "";
              let aqiColor = "";

              switch (aqi) {
                case 1:
                  aqiText = "良好";
                  aqiColor = "#28a745";
                  break;
                case 2:
                  aqiText = "普通";
                  aqiColor = "#ffc107";
                  break;
                case 3:
                  aqiText = "對敏感族群不健康";
                  aqiColor = "#fd7e14";
                  break;
                case 4:
                  aqiText = "不健康";
                  aqiColor = "#dc3545";
                  break;
                case 5:
                  aqiText = "非常不健康";
                  aqiColor = "#6f42c1";
                  break;
                default:
                  aqiText = "未知";
                  aqiColor = "#6c757d";
              }

              document.getElementById("result").innerHTML = `
                <div class="row g-3 align-items-center justify-content-center">
                  <div class="col-12 col-md-4">
                    <img src="${iconUrl}" alt="${desc}" class="weather-icon" />
                  </div>
                  <div class="col-12 col-md-8 text-center text-md-start">
                    <h3 class="fw-bold">${name}</h3>
                    <p class="mb-1"><i class="bi bi-thermometer-half"></i> 溫度：<span class="fw-bold">${temp} °C</span></p>
                    <p class="mb-1"><i class="bi bi-cloud-fill"></i> 天氣：<span class="fw-bold">${desc}</span></p>
                    <p class="mb-1"><i class="bi bi-droplet-fill"></i> 濕度：<span class="fw-bold">${humidity}%</span></p>
                    <p class="mb-1"><i class="bi bi-wind"></i> 風速：<span class="fw-bold">${wind} m/s</span></p>
                    <p class="mb-1"><i class="bi bi-geo-alt-fill"></i> 座標：<span class="fw-bold">${lat.toFixed(4)}, ${lon.toFixed(4)}</span></p>
                    <p class="text-muted small">更新時間：${dt}</p>
                  </div>
                </div>
                <hr/>
                <div class="text-center text-md-start">
                  <h5 class="fw-bold">空氣品質</h5>
                  <p>AQI 指數：
                    <span class="aqi-badge" style="background-color:${aqiColor}">
                      ${aqi} (${aqiText})
                    </span>
                  </p>
                  <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between">
                      <span><i class="bi bi-circle-fill text-secondary me-2"></i>PM2.5</span>
                      <span>${pm25} μg/m³</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span><i class="bi bi-circle-fill text-secondary me-2"></i>PM10</span>
                      <span>${pm10} μg/m³</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span><i class="bi bi-circle-fill text-secondary me-2"></i>CO</span>
                      <span>${co} μg/m³</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span><i class="bi bi-circle-fill text-secondary me-2"></i>NO₂</span>
                      <span>${no2} μg/m³</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                      <span><i class="bi bi-circle-fill text-secondary me-2"></i>O₃</span>
                      <span>${o3} μg/m³</span>
                    </li>
                  </ul>
                </div>
              `;
            })
            .catch(() => {
              document.getElementById("result").innerHTML = `<div class="alert alert-danger">無法取得空氣品質資料，請稍後再試。</div>`;
            });
        })
        .catch(error => {
          document.getElementById("result").innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
        });
    }
  </script>
</body>
</html>
